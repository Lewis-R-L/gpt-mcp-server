# globalMcpServer å’Œ transport çš„å…³ç³»

## ğŸ“‹ æ¦‚è¿°

`globalMcpServer` å’Œ `transport` æ˜¯ MCP æ¶æ„ä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶ï¼Œå®ƒä»¬çš„å…³ç³»æ˜¯ï¼š**ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆServerï¼‰ä¸ä¼ è¾“å±‚ï¼ˆTransportï¼‰çš„åˆ†ç¦»**ã€‚

---

## ğŸ”‘ æ ¸å¿ƒæ¦‚å¿µ

### `globalMcpServer` - ä¸šåŠ¡é€»è¾‘å±‚

**å®šä¹‰ï¼š** å…¨å±€çš„ MCP æœåŠ¡å™¨å®ä¾‹ï¼Œè´Ÿè´£ï¼š
- æ³¨å†Œæ‰€æœ‰å·¥å…·ï¼ˆtoolsï¼‰
- æ³¨å†Œæ‰€æœ‰èµ„æºï¼ˆresourcesï¼‰
- æ³¨å†Œæ‰€æœ‰æç¤ºï¼ˆpromptsï¼‰
- å¤„ç† MCP åè®®é€»è¾‘

**ç‰¹ç‚¹ï¼š**
- âœ… **å…¨å±€å”¯ä¸€**ï¼šæ•´ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ªå®ä¾‹
- âœ… **æ— çŠ¶æ€**ï¼šä¸å­˜å‚¨ä¼šè¯ä¿¡æ¯
- âœ… **ä¸šåŠ¡é€»è¾‘**ï¼šåŒ…å«æ‰€æœ‰å·¥å…·çš„å®ç°

### `transport` - ä¼ è¾“å±‚

**å®šä¹‰ï¼š** æ¯ä¸ªä¼šè¯çš„ä¼ è¾“å®ä¾‹ï¼Œè´Ÿè´£ï¼š
- å¤„ç† HTTP è¯·æ±‚/å“åº”
- å°† HTTP è¯·æ±‚è½¬æ¢ä¸º MCP åè®®è°ƒç”¨
- å°† MCP åè®®å“åº”è½¬æ¢ä¸º HTTP å“åº”
- ç®¡ç†ä¼šè¯çº§åˆ«çš„çŠ¶æ€

**ç‰¹ç‚¹ï¼š**
- âœ… **æ¯ä¸ªä¼šè¯ä¸€ä¸ª**ï¼šæ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ›å»ºä¸€ä¸ª transport
- âœ… **æœ‰çŠ¶æ€**ï¼šç®¡ç†ä¼šè¯ ID å’Œä¼šè¯çŠ¶æ€
- âœ… **ä¼ è¾“åè®®**ï¼šå¤„ç† HTTP/SSE ç­‰ä¼ è¾“åè®®

---

## ğŸ”— å…³ç³»å›¾è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    globalMcpServer                          â”‚
â”‚                  (å…¨å±€å”¯ä¸€ï¼Œä¸šåŠ¡é€»è¾‘å±‚)                        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  æ³¨å†Œçš„å·¥å…·ï¼š                                       â”‚    â”‚
â”‚  â”‚  - ping                                            â”‚    â”‚
â”‚  â”‚  - all-taught-languages                            â”‚    â”‚
â”‚  â”‚  - teacher-recommendation                          â”‚    â”‚
â”‚  â”‚  - my-calendar-events                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  æ³¨å†Œçš„èµ„æºï¼š                                       â”‚    â”‚
â”‚  â”‚  - teacher-recommendation-ui                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ connect()
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚               â”‚               â”‚
        â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  transport 1 â”‚ â”‚  transport 2 â”‚ â”‚  transport 3 â”‚
â”‚ (ä¼šè¯ A)      â”‚ â”‚ (ä¼šè¯ B)      â”‚ â”‚ (ä¼šè¯ C)      â”‚
â”‚              â”‚ â”‚              â”‚ â”‚              â”‚
â”‚ - sessionId  â”‚ â”‚ - sessionId  â”‚ â”‚ - sessionId  â”‚
â”‚ - HTTPå¤„ç†    â”‚ â”‚ - HTTPå¤„ç†    â”‚ â”‚ - HTTPå¤„ç†    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚               â”‚               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
              HTTP è¯·æ±‚/å“åº”
```

---

## ğŸ“ ä»£ç ä½ç½®

### 1. åˆ›å»º globalMcpServerï¼ˆmain.ts:46-91ï¼‰

```typescript
// æ–‡ä»¶: mcp-server/src/main.ts
// ç¬¬ 46-91 è¡Œ

function initializeGlobalMcpServer(): void {
  // ğŸ‘‡ åˆ›å»ºå…¨å±€ MCP æœåŠ¡å™¨å®ä¾‹ï¼ˆåªåˆ›å»ºä¸€æ¬¡ï¼‰
  globalMcpServer = new McpServer({
    name: 'italki-mcp',
    version: '0.1.0',
    capabilities: {
      tools: {}
    }
  });

  // æ³¨å†Œæ‰€æœ‰å·¥å…·ã€èµ„æºã€æç¤º
  MCP_MODULES.forEach(module => {
    if (module.type === 'tool') {
      // æ³¨å†Œå·¥å…·åˆ° globalMcpServer
      globalMcpServer.registerTool(mcpTool.name, mcpTool.config, ...);
    } else if (module.type === 'resource') {
      // æ³¨å†Œèµ„æºåˆ° globalMcpServer
      globalMcpServer.registerResource(...);
    } else if (module.type === 'prompt') {
      // æ³¨å†Œæç¤ºåˆ° globalMcpServer
      globalMcpServer.registerPrompt(...);
    }
  });
}
```

**å…³é”®ç‚¹ï¼š**
- âœ… åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶åˆ›å»ºä¸€æ¬¡
- âœ… æ³¨å†Œæ‰€æœ‰å·¥å…·ã€èµ„æºã€æç¤º
- âœ… å…¨å±€å…±äº«ï¼Œæ‰€æœ‰ä¼šè¯å…±ç”¨

---

### 2. åˆ›å»º transport å¹¶è¿æ¥ï¼ˆmain.ts:94-118ï¼‰

```typescript
// æ–‡ä»¶: mcp-server/src/main.ts
// ç¬¬ 94-118 è¡Œ

function createMCPSession(): MCPSession {
  const sessionId = randomUUID();
  const now = new Date();
  
  // ğŸ‘‡ ä¸ºæ¯ä¸ªä¼šè¯åˆ›å»ºä¸€ä¸ª transportï¼ˆæ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥ä¸€ä¸ªï¼‰
  const transport = new StreamableHTTPServerTransport({
    sessionIdGenerator: () => sessionId,
    enableJsonResponse: true,
  });

  // ğŸ‘‡ å…³é”®ï¼šå°†å…¨å±€æœåŠ¡å™¨è¿æ¥åˆ°è¿™ä¸ª transport
  globalMcpServer.connect(transport);

  const session: MCPSession = {
    id: sessionId,
    transport,  // æ¯ä¸ªä¼šè¯æœ‰è‡ªå·±çš„ transport
    createdAt: now,
    lastActivity: now
  };

  sessions.set(sessionId, session);
  return session;
}
```

**å…³é”®ç‚¹ï¼š**
- âœ… æ¯ä¸ªä¼šè¯åˆ›å»ºä¸€ä¸ªæ–°çš„ transport
- âœ… é€šè¿‡ `globalMcpServer.connect(transport)` è¿æ¥
- âœ… ä¸€ä¸ª `globalMcpServer` å¯ä»¥è¿æ¥åˆ°å¤šä¸ª `transport`

---

### 3. ä½¿ç”¨ transport å¤„ç†è¯·æ±‚ï¼ˆmain.ts:451-494ï¼‰

```typescript
// æ–‡ä»¶: mcp-server/src/main.ts
// ç¬¬ 451-494 è¡Œ

app.all('/mcp', async (req, res) => {
  try {
    const sessionId = req.get('Mcp-Session-Id');
    
    if (!sessionId) {
      // åˆ›å»ºæ–°ä¼šè¯
      const session = createMCPSession();
      res.set('Mcp-Session-Id', session.id);
      
      // ğŸ‘‡ ä½¿ç”¨è¿™ä¸ªä¼šè¯çš„ transport å¤„ç†è¯·æ±‚
      await session.transport.handleRequest(req as any, res as any, req.body);
      return;
    }
    
    // è·å–å·²æœ‰ä¼šè¯
    const session = getSession(sessionId);
    if (!session) {
      // ä¼šè¯ä¸å­˜åœ¨
      return;
    }
    
    // ğŸ‘‡ ä½¿ç”¨è¿™ä¸ªä¼šè¯çš„ transport å¤„ç†è¯·æ±‚
    await session.transport.handleRequest(req as any, res as any, req.body);
    
  } catch (error) {
    // é”™è¯¯å¤„ç†
  }
});
```

**å…³é”®ç‚¹ï¼š**
- âœ… æ¯ä¸ªè¯·æ±‚ä½¿ç”¨å¯¹åº”ä¼šè¯çš„ transport
- âœ… transport å¤„ç† HTTP è¯·æ±‚ï¼Œç„¶åè°ƒç”¨ globalMcpServer

---

## ğŸ”„ æ•°æ®æµ

### å®Œæ•´è¯·æ±‚æµç¨‹

```
1. HTTP è¯·æ±‚åˆ°è¾¾
   POST /mcp
   â†“
2. Express è·¯ç”± (main.ts:451)
   app.all('/mcp', ...)
   â†“
3. è·å–æˆ–åˆ›å»ºä¼šè¯
   const session = getSession(sessionId) || createMCPSession();
   â†“
4. transport å¤„ç†è¯·æ±‚ (main.ts:460/480)
   session.transport.handleRequest(req, res, req.body)
   â†“
5. transport å†…éƒ¨å¤„ç†ï¼ˆMCP SDKï¼‰
   - è§£æ JSON-RPC è¯·æ±‚
   - æå–è®¤è¯ä¿¡æ¯ï¼ˆä» req.authï¼‰
   - è°ƒç”¨ globalMcpServer ä¸­æ³¨å†Œçš„å·¥å…·
   â†“
6. globalMcpServer æ‰§è¡Œå·¥å…· (main.ts:59-74)
   - æ‰¾åˆ°å¯¹åº”çš„å·¥å…·
   - æ£€æŸ¥è®¤è¯ï¼ˆå¦‚æœéœ€è¦ï¼‰
   - è°ƒç”¨å·¥å…·å›è°ƒ
   â†“
7. å·¥å…·æ‰§è¡Œ (ä¾‹å¦‚: calendar.ts:152)
   toolCallback(args, extra)
   â†“
8. è¿”å›ç»“æœ
   - é€šè¿‡ transport è½¬æ¢ä¸º HTTP å“åº”
   - è¿”å›ç»™å®¢æˆ·ç«¯
```

---

## ğŸ¯ ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

### 1. åˆ†ç¦»å…³æ³¨ç‚¹

**ä¸šåŠ¡é€»è¾‘ vs ä¼ è¾“åè®®ï¼š**
- `globalMcpServer`ï¼šä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼ˆå·¥å…·ã€èµ„æºã€æç¤ºï¼‰
- `transport`ï¼šä¸“æ³¨äºä¼ è¾“åè®®ï¼ˆHTTPã€SSEã€WebSocket ç­‰ï¼‰

**å¥½å¤„ï¼š**
- âœ… å¯ä»¥æ›´æ¢ä¼ è¾“åè®®è€Œä¸å½±å“ä¸šåŠ¡é€»è¾‘
- âœ… å¯ä»¥æ”¯æŒå¤šç§ä¼ è¾“åè®®ï¼ˆHTTPã€SSEã€WebSocketï¼‰
- âœ… ä»£ç æ›´æ¸…æ™°ï¼ŒèŒè´£åˆ†æ˜

---

### 2. å¤šä¼šè¯æ”¯æŒ

**ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¤šä¸ªå®¢æˆ·ç«¯ï¼š**
- ä¸€ä¸ª `globalMcpServer` å¯ä»¥æœåŠ¡å¤šä¸ªå®¢æˆ·ç«¯
- æ¯ä¸ªå®¢æˆ·ç«¯æœ‰è‡ªå·±çš„ `transport` å’Œä¼šè¯
- ä¼šè¯ä¹‹é—´ç›¸äº’ç‹¬ç«‹

**å¥½å¤„ï¼š**
- âœ… æ”¯æŒå¹¶å‘è¿æ¥
- âœ… ä¼šè¯éš”ç¦»
- âœ… èµ„æºå¤ç”¨ï¼ˆå…±äº«å·¥å…·æ³¨å†Œï¼‰

---

### 3. çŠ¶æ€ç®¡ç†

**å…¨å±€çŠ¶æ€ vs ä¼šè¯çŠ¶æ€ï¼š**
- `globalMcpServer`ï¼šæ— çŠ¶æ€ï¼ˆå·¥å…·æ³¨å†Œæ˜¯å…¨å±€çš„ï¼‰
- `transport`ï¼šæœ‰çŠ¶æ€ï¼ˆæ¯ä¸ªä¼šè¯æœ‰è‡ªå·±çš„çŠ¶æ€ï¼‰

**å¥½å¤„ï¼š**
- âœ… å·¥å…·æ³¨å†Œä¸€æ¬¡ï¼Œæ‰€æœ‰ä¼šè¯å…±äº«
- âœ… ä¼šè¯çŠ¶æ€ç‹¬ç«‹ç®¡ç†
- âœ… æ˜“äºæ‰©å±•å’Œç»´æŠ¤

---

## ğŸ“Š å¯¹æ¯”è¡¨

| ç‰¹æ€§ | globalMcpServer | transport |
|------|----------------|-----------|
| **æ•°é‡** | å…¨å±€å”¯ä¸€ï¼ˆ1ä¸ªï¼‰ | æ¯ä¸ªä¼šè¯ä¸€ä¸ªï¼ˆå¤šä¸ªï¼‰ |
| **åˆ›å»ºæ—¶æœº** | æœåŠ¡å™¨å¯åŠ¨æ—¶ | æ¯æ¬¡åˆ›å»ºä¼šè¯æ—¶ |
| **èŒè´£** | ä¸šåŠ¡é€»è¾‘ï¼ˆå·¥å…·æ³¨å†Œï¼‰ | ä¼ è¾“åè®®ï¼ˆHTTPå¤„ç†ï¼‰ |
| **çŠ¶æ€** | æ— çŠ¶æ€ | æœ‰çŠ¶æ€ï¼ˆä¼šè¯IDç­‰ï¼‰ |
| **ç”Ÿå‘½å‘¨æœŸ** | åº”ç”¨ç”Ÿå‘½å‘¨æœŸ | ä¼šè¯ç”Ÿå‘½å‘¨æœŸ |
| **è¿æ¥å…³ç³»** | å¯ä»¥è¿æ¥åˆ°å¤šä¸ª transport | è¿æ¥åˆ°ä¸€ä¸ª globalMcpServer |

---

## ğŸ” å…³é”®ä»£ç è§£æ

### connect() æ–¹æ³•çš„ä½œç”¨

```typescript
// main.ts:105
globalMcpServer.connect(transport);
```

**ä½œç”¨ï¼š**
- å°† `globalMcpServer` è¿æ¥åˆ° `transport`
- å»ºç«‹åŒå‘é€šä¿¡é€šé“
- å…è®¸ transport è°ƒç”¨ globalMcpServer ä¸­æ³¨å†Œçš„å·¥å…·

**å†…éƒ¨æœºåˆ¶ï¼ˆç®€åŒ–ï¼‰ï¼š**
```typescript
// MCP SDK å†…éƒ¨ï¼ˆä¼ªä»£ç ï¼‰
class McpServer {
  connect(transport: Transport) {
    // å»ºç«‹è¿æ¥
    transport.onRequest((request) => {
      // å½“ transport æ”¶åˆ°è¯·æ±‚æ—¶
      // è°ƒç”¨ globalMcpServer ä¸­æ³¨å†Œçš„å·¥å…·
      this.handleRequest(request);
    });
  }
}
```

---

### handleRequest() æ–¹æ³•çš„ä½œç”¨

```typescript
// main.ts:460/480
await session.transport.handleRequest(req, res, req.body);
```

**ä½œç”¨ï¼š**
- å¤„ç† HTTP è¯·æ±‚
- è§£æ JSON-RPC æ ¼å¼
- è°ƒç”¨ globalMcpServer ä¸­å¯¹åº”çš„å·¥å…·
- å°†ç»“æœè½¬æ¢ä¸º HTTP å“åº”

**å†…éƒ¨æµç¨‹ï¼ˆç®€åŒ–ï¼‰ï¼š**
```typescript
// MCP SDK å†…éƒ¨ï¼ˆä¼ªä»£ç ï¼‰
class StreamableHTTPServerTransport {
  async handleRequest(req, res, body) {
    // 1. è§£æ JSON-RPC è¯·æ±‚
    const request = JSON.parse(body);
    
    // 2. æå–è®¤è¯ä¿¡æ¯
    const authInfo = req.auth || null;
    
    // 3. è°ƒç”¨ globalMcpServer ä¸­æ³¨å†Œçš„å·¥å…·
    const result = await this.connectedServer.handleRequest(request, authInfo);
    
    // 4. è½¬æ¢ä¸º HTTP å“åº”
    res.json(result);
  }
}
```

---

## ğŸ’¡ å®é™…ä¾‹å­

### åœºæ™¯ï¼š3ä¸ªå®¢æˆ·ç«¯åŒæ—¶è¿æ¥

```
å®¢æˆ·ç«¯ A è¿æ¥
  â†“
åˆ›å»º transport A
  â†“
globalMcpServer.connect(transport A)
  â†“
transport A å¤„ç†å®¢æˆ·ç«¯ A çš„è¯·æ±‚
  â†“
è°ƒç”¨ globalMcpServer ä¸­çš„å·¥å…·

å®¢æˆ·ç«¯ B è¿æ¥
  â†“
åˆ›å»º transport B
  â†“
globalMcpServer.connect(transport B)  // åŒä¸€ä¸ª globalMcpServer
  â†“
transport B å¤„ç†å®¢æˆ·ç«¯ B çš„è¯·æ±‚
  â†“
è°ƒç”¨ globalMcpServer ä¸­çš„å·¥å…·ï¼ˆå…±äº«ï¼‰

å®¢æˆ·ç«¯ C è¿æ¥
  â†“
åˆ›å»º transport C
  â†“
globalMcpServer.connect(transport C)  // åŒä¸€ä¸ª globalMcpServer
  â†“
transport C å¤„ç†å®¢æˆ·ç«¯ C çš„è¯·æ±‚
  â†“
è°ƒç”¨ globalMcpServer ä¸­çš„å·¥å…·ï¼ˆå…±äº«ï¼‰
```

**ç»“æœï¼š**
- âœ… 3 ä¸ª transportï¼ˆæ¯ä¸ªå®¢æˆ·ç«¯ä¸€ä¸ªï¼‰
- âœ… 1 ä¸ª globalMcpServerï¼ˆæ‰€æœ‰å®¢æˆ·ç«¯å…±äº«ï¼‰
- âœ… æ‰€æœ‰å®¢æˆ·ç«¯éƒ½å¯ä»¥ä½¿ç”¨ç›¸åŒçš„å·¥å…·

---

## ğŸ“ æ€»ç»“

**å…³ç³»ï¼š**
1. âœ… `globalMcpServer` æ˜¯ä¸šåŠ¡é€»è¾‘å±‚ï¼Œå…¨å±€å”¯ä¸€ï¼Œæ³¨å†Œæ‰€æœ‰å·¥å…·
2. âœ… `transport` æ˜¯ä¼ è¾“å±‚ï¼Œæ¯ä¸ªä¼šè¯ä¸€ä¸ªï¼Œå¤„ç† HTTP è¯·æ±‚
3. âœ… é€šè¿‡ `connect()` æ–¹æ³•å»ºç«‹è¿æ¥
4. âœ… ä¸€ä¸ª `globalMcpServer` å¯ä»¥è¿æ¥åˆ°å¤šä¸ª `transport`
5. âœ… `transport` è´Ÿè´£å°† HTTP è¯·æ±‚è½¬æ¢ä¸º MCP è°ƒç”¨ï¼Œç„¶åè°ƒç”¨ `globalMcpServer` ä¸­çš„å·¥å…·

**è®¾è®¡æ¨¡å¼ï¼š**
- **åˆ†ç¦»å…³æ³¨ç‚¹**ï¼šä¸šåŠ¡é€»è¾‘ä¸ä¼ è¾“åè®®åˆ†ç¦»
- **å¤šè·¯å¤ç”¨**ï¼šä¸€ä¸ªæœåŠ¡å™¨æœåŠ¡å¤šä¸ªå®¢æˆ·ç«¯
- **çŠ¶æ€ç®¡ç†**ï¼šå…¨å±€æ— çŠ¶æ€ï¼Œä¼šè¯æœ‰çŠ¶æ€

**ç±»æ¯”ï¼š**
- `globalMcpServer` = é¤å…çš„èœå•å’Œå¨å¸ˆï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
- `transport` = æœåŠ¡å‘˜ï¼ˆä¼ è¾“å±‚ï¼Œæ¯ä¸ªæ¡Œå­ä¸€ä¸ªï¼‰
- å¤šä¸ªæœåŠ¡å‘˜ï¼ˆtransportï¼‰å…±äº«åŒä¸€ä¸ªèœå•å’Œå¨å¸ˆï¼ˆglobalMcpServerï¼‰

